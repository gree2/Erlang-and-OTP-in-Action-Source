<html>
<head><title>/Users/martinjlogan/book_workspace/code/chapter_11/_build/development/docs/coverage/gen_web_server/gen_web_server.html</title></head><body bgcolor=white text=black>
<pre>
File generated from /Users/martinjlogan/book_workspace/code/chapter_11/_build/development/apps/gen_web_server-0.1.0.2/ebin/../src/gen_web_server.erl by COVER 2010-04-13 at 16:47:42

****************************************************************************

        |  %%%-------------------------------------------------------------------
        |  %%% @author Martin Logan &lt;martinjlogan@Macintosh.local&gt;
        |  %%% @copyright (C) 2010, Martin Logan
        |  %%% @doc
        |  %%%  The main interface for the gen_web_server application
        |  %%% @end
        |  %%% Created : 10 Feb 2010 by Martin Logan &lt;martinjlogan@Macintosh.local&gt;
        |  %%%-------------------------------------------------------------------
        |  -module(gen_web_server).
        |  
        |  %% API
        |  -export([start_link/4, start_link/3, http_reply/1, http_reply/3]).
        |  
        |  -export([behaviour_info/1]).
        |  
        |  -include("eunit.hrl").
        |  
        |  behaviour_info(callbacks) -&gt;
<font color=red>     0..|      [{init,1},</font>
        |       {head, 3},
        |       {get, 3},
        |       {delete, 3},
        |       {options, 4},
        |       {post, 4},
        |       {put, 4},
        |       {trace, 4},
        |       {connect, 4},
        |       {other_methods, 4}];
        |  behaviour_info(_Other) -&gt;
<font color=red>     0..|      undefined.</font>
        |  
        |  %%%===================================================================
        |  %%% API
        |  %%%===================================================================
        |  
        |  %%--------------------------------------------------------------------
        |  %% @doc Start a new gen_web_server behaviour container.
        |  %% @spec (Callback, IP, Port, UserArgs) -&gt; {ok, Pid}
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  start_link(Callback, IP, Port, UserArgs) -&gt;
<font color=red>     0..|      gws_connection_sup:start_link(Callback, IP, Port, UserArgs).</font>
        |  
        |  %% @spec start_link(Callback, Port, UserArgs) -&gt; {ok, Pid} | ignore | {error, Error}
        |  %% @equiv start_link(Callback, DefaultIP, Port, UserArgs)
        |  start_link(Callback, Port, UserArgs) -&gt;
<font color=red>     0..|      start_link(Callback, default_ip, Port, UserArgs).</font>
        |      
        |  %%--------------------------------------------------------------------
        |  %% @doc helper function for creating a very minimally specified
        |  %%      http message
        |  %% @spec (Code, Headers, Body) -&gt; ok
        |  %% @end
        |  %%--------------------------------------------------------------------
        |  http_reply(Code, Headers, Body) when is_list(Body) -&gt;
     2..|      http_reply(Code, Headers, list_to_binary(Body));
        |  http_reply(Code, Headers, Body) -&gt;
     3..|      list_to_binary(["HTTP/1.1 ", code_to_code_and_string(Code), "\r\n",
        |  		    format_headers(Headers),
        |  		    "Content-Length: ", integer_to_list(size(Body)), 
        |  		    "\r\n\r\n", Body]).
        |  %HeadStr = lists:flatten(["HTTP/1.1 ", code_to_code_and_string(Code), "\r\n",
        |  			     %format_headers(Headers),
        |  			     %"Content-Length: ", integer_to_list(size(Body)), 
        |  			     %"\r\n\r\n"]),
        |      %list_to_binary([HeadStr, Body]).
        |  
        |  %% @spec (Code) -&gt; ok
        |  %% @equiv http_reply(Code, [{"Content-Type", "text/html"}], "") 
        |  http_reply(Code) -&gt;
<font color=red>     0..|      http_reply(Code, [{"Content-Type", "text/html"}], "").</font>
        |  
        |  format_headers([{Header, Value}|T]) -&gt;
     3..|      [tos(Header), ": ", Value, "\r\n"|format_headers(T)];
        |  format_headers([]) -&gt;
     3..|      [].
        |  
<font color=red>     0..|  tos(Val) when is_atom(Val) -&gt; atom_to_list(Val);</font>
     3..|  tos(Val)                   -&gt; Val.
        |      
        |  %%%===================================================================
        |  %%% Internal functions
        |  %%%===================================================================
        |  
        |  %% @private
        |  %% @doc Given a number of a standard HTTP response code, return
        |  %% a binary (string) of the number and name.
        |  %%
        |  %% Example:
        |  %% ```code_to_code_and_string(404) =&gt; "404 Not Found"
        |  %% '''
        |  %%
        |  %% The supported status codes are taken from:
        |  %%   ["http://en.wikipedia.org/wiki/List_of_HTTP_status_codes"]
        |  %%
        |  %% @spec (integer()) -&gt; binary()
<font color=red>     0..|  code_to_code_and_string(100) -&gt; "100 Continue";</font>
<font color=red>     0..|  code_to_code_and_string(101) -&gt; "101 Switching Protocols";</font>
<font color=red>     0..|  code_to_code_and_string(102) -&gt; "102 Processing";</font>
     3..|  code_to_code_and_string(200) -&gt; "200 OK";
<font color=red>     0..|  code_to_code_and_string(201) -&gt; "201 Created";</font>
<font color=red>     0..|  code_to_code_and_string(202) -&gt; "202 Accepted";</font>
<font color=red>     0..|  code_to_code_and_string(203) -&gt; "203 Non-Authoritative Information";</font>
<font color=red>     0..|  code_to_code_and_string(204) -&gt; "204 No Content";</font>
<font color=red>     0..|  code_to_code_and_string(205) -&gt; "205 Reset Content";</font>
<font color=red>     0..|  code_to_code_and_string(206) -&gt; "206 Partial Content";</font>
<font color=red>     0..|  code_to_code_and_string(207) -&gt; "207 Multi-Status";</font>
<font color=red>     0..|  code_to_code_and_string(300) -&gt; "300 Multiple Choices";</font>
<font color=red>     0..|  code_to_code_and_string(301) -&gt; "301 Moved Permanently";</font>
<font color=red>     0..|  code_to_code_and_string(302) -&gt; "302 Found";</font>
<font color=red>     0..|  code_to_code_and_string(303) -&gt; "303 See Other";</font>
<font color=red>     0..|  code_to_code_and_string(304) -&gt; "304 Not Modified";</font>
<font color=red>     0..|  code_to_code_and_string(305) -&gt; "305 Use Proxy";</font>
<font color=red>     0..|  code_to_code_and_string(307) -&gt; "307 Temporary Redirect";</font>
<font color=red>     0..|  code_to_code_and_string(400) -&gt; "400 Bad Request";</font>
<font color=red>     0..|  code_to_code_and_string(401) -&gt; "401 Unauthorized";</font>
<font color=red>     0..|  code_to_code_and_string(402) -&gt; "402 Payment Required";</font>
<font color=red>     0..|  code_to_code_and_string(403) -&gt; "403 Forbidden";</font>
<font color=red>     0..|  code_to_code_and_string(404) -&gt; "404 Not Found";</font>
<font color=red>     0..|  code_to_code_and_string(405) -&gt; "405 Method Not Allowed";</font>
<font color=red>     0..|  code_to_code_and_string(406) -&gt; "406 Not Acceptable";</font>
<font color=red>     0..|  code_to_code_and_string(407) -&gt; "407 Proxy Authentication Required";</font>
<font color=red>     0..|  code_to_code_and_string(408) -&gt; "408 Request Time-out";</font>
<font color=red>     0..|  code_to_code_and_string(409) -&gt; "409 Conflict";</font>
<font color=red>     0..|  code_to_code_and_string(410) -&gt; "410 Gone";</font>
<font color=red>     0..|  code_to_code_and_string(411) -&gt; "411 Length Required";</font>
<font color=red>     0..|  code_to_code_and_string(412) -&gt; "412 Precondition Failed";</font>
<font color=red>     0..|  code_to_code_and_string(413) -&gt; "413 Request Entity Too Large";</font>
<font color=red>     0..|  code_to_code_and_string(414) -&gt; "414 Request-URI Too Large";</font>
<font color=red>     0..|  code_to_code_and_string(415) -&gt; "415 Unsupported Media Type";</font>
<font color=red>     0..|  code_to_code_and_string(416) -&gt; "416 Requested range not satisfiable";</font>
<font color=red>     0..|  code_to_code_and_string(417) -&gt; "417 Expectation Failed";</font>
        |  code_to_code_and_string(421) -&gt;
<font color=red>     0..|      "421 There are too many connections from your internet address";</font>
<font color=red>     0..|  code_to_code_and_string(422) -&gt; "422 Unprocessable Entity";</font>
<font color=red>     0..|  code_to_code_and_string(423) -&gt; "423 Locked";</font>
<font color=red>     0..|  code_to_code_and_string(424) -&gt; "424 Failed Dependency";</font>
<font color=red>     0..|  code_to_code_and_string(425) -&gt; "425 Unordered Collection";</font>
<font color=red>     0..|  code_to_code_and_string(426) -&gt; "426 Upgrade Required";</font>
<font color=red>     0..|  code_to_code_and_string(449) -&gt; "449 Retry With";</font>
<font color=red>     0..|  code_to_code_and_string(500) -&gt; "500 Internal Server Error";</font>
<font color=red>     0..|  code_to_code_and_string(501) -&gt; "501 Not Implemented";</font>
<font color=red>     0..|  code_to_code_and_string(502) -&gt; "502 Bad Gateway";</font>
<font color=red>     0..|  code_to_code_and_string(503) -&gt; "503 Service Unavailable";</font>
<font color=red>     0..|  code_to_code_and_string(504) -&gt; "504 Gateway Time-out";</font>
<font color=red>     0..|  code_to_code_and_string(505) -&gt; "505 HTTP Version not supported";</font>
<font color=red>     0..|  code_to_code_and_string(506) -&gt; "506 Variant Also Negotiates";</font>
<font color=red>     0..|  code_to_code_and_string(507) -&gt; "507 Insufficient Storage";</font>
<font color=red>     0..|  code_to_code_and_string(509) -&gt; "509 Bandwidth Limit Exceeded";</font>
<font color=red>     0..|  code_to_code_and_string(510) -&gt; "510 Not Extended";</font>
<font color=red>     0..|  code_to_code_and_string(Code) -&gt; Code.</font>
        |  
        |  http_reply_test() -&gt;
     1..|      Reply = &lt;&lt;"HTTP/1.1 200 OK\r\nheader: value\r\nContent-Length: 8\r\n\r\nall good"&gt;&gt;,
     1..|      ?assertMatch(Reply, http_reply(200, [{"header", "value"}], "all good")),
     1..|      ?assertMatch(Reply, http_reply(200, [{"header", "value"}], &lt;&lt;"all good"&gt;&gt;)),
     1..|      ?assertMatch(Reply, http_reply(200, [{"header", "value"}], ["all"," good"])).
</pre>
</body>
</html>
